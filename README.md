# 基于单目视觉的距离估计工具

这个工具使用单目摄像头通过已知物体大小来估计物体到摄像头的距离。它基于针孔相机模型和相似三角形原理。

## 原理

距离估计基于以下公式：

1. 相机校准：F = (P × D) / W
2. 距离估计：D = (W × F) / P

其中：
- F 是焦距（像素）
- P 是物体在图像中的像素宽度
- D 是物体到摄像头的距离（厘米）
- W 是物体的实际宽度（厘米）

## 安装依赖

```bash
pip install opencv-python numpy
```

## 使用方法

### 1. 相机校准

首先需要校准相机焦距：

```bash
python distance_estimation.py --known-width 10 --calibrate --known-distance 50 --color red
```

参数说明：
- `--known-width`: 目标物体的实际宽度（厘米）
- `--calibrate`: 启用校准模式
- `--known-distance`: 校准时物体到摄像头的距离（厘米）
- `--color`: 要检测的物体颜色（red, green, blue, yellow）

校准时，将已知宽度的物体放在已知距离处，然后按下'c'键进行校准。

### 2. 距离估计

校准完成后，程序会自动进入距离估计模式：

```bash
python distance_estimation.py --known-width 10 --color red
```

如果已经校准过相机，可以直接运行上面的命令进行距离估计。

## 注意事项

1. 校准时应使用与实际测量相同的物体
2. 确保物体颜色与选择的颜色范围匹配
3. 光照条件会影响颜色检测效果
4. 摄像头应保持固定，避免移动或更换，否则需要重新校准

## 颜色范围

程序预设了以下颜色范围（HSV格式）：
- 红色：(0, 100, 100) 到 (10, 255, 255)
- 绿色：(35, 100, 100) 到 (85, 255, 255)
- 蓝色：(100, 100, 100) 到 (140, 255, 255)
- 黄色：(20, 100, 100) 到 (35, 255, 255)

如需调整颜色范围，可以修改源代码中的`color_ranges`字典。
